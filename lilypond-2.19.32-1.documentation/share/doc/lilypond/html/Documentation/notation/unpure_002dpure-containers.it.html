<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Copyright C 1999-2015 degli autori.

La traduzione della seguente nota di copyright è gentilmente
offerta per le persone che non parlano inglese, ma solo
la nota in inglese ha valore legale.

The translation of the following copyright notice is provided
for courtesy to non-English speakers, but only the notice in English
legally counts.

E' garantito il permesso di copiare, distribuire e/o modificare questo
documento seguendo i termini della Licenza per Documentazione
Libera GNU, Versione 1.1 o ogni versione successiva pubblicata dalla
Free Software Foundation; senza alcuna sezione non modificabile.
Una copia della licenza è acclusa nella sezione intitolata "Licenza
per Documentazione Libera GNU".


Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1
or any later version published by the Free Software Foundation;
with no Invariant Sections.
A copy of the license is included in the section entitled "GNU
Free Documentation License".

 -->
<!-- Created on Novembre 22, 2015 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>Guida alla Notazione di LilyPond: 5.5.6 Unpure-pure containers</title>

<meta name="description" content="Guida alla Notazione di LilyPond: 5.5.6 Unpure-pure containers">
<meta name="keywords" content="Guida alla Notazione di LilyPond: 5.5.6 Unpure-pure containers">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.it.html#index" rel="start" title="LilyPond &mdash; Guida alla Notazione">
<link href="lilypond-command-index.it.html#lilypond-command-index" rel="index" title="D. Indice dei comandi di LilyPond">
<link href="index_toc.it.html#SEC_Contents" rel="contents" title="Indice">
<link href="index_abt.it.html#SEC_About" rel="help" title="Informazioni su questo documento">
<link href="advanced-tweaks.it.html#advanced-tweaks" rel="up" title="5.5 Advanced tweaks">
<link href="lilypond-index.it.html#lilypond-index" rel="next" title="E. Indice di LilyPond">
<link href="modifying-broken-spanners.it.html#modifying-broken-spanners" rel="previous" title="5.5.5 Modifying broken spanners">
<link rel="stylesheet" type="text/css" title="Default style" href="../../Documentation/css/lilypond-manuals.css">
<!--[if lte IE 7]>
<link href="../../Documentation/css/lilypond-manuals-ie-fixes.css" rel="stylesheet" type="text/css">
<![endif]-->


</head>

<body lang="it" class="notation devStatus">


<div id="main">
<a name="Unpure_002dpure-containers"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="changing-defaults.it.html" title="Inizio di questo capitolo o capitolo precedente"> &lt;&lt; Changing defaults&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.it.html" title="Copertina (inizio) del documento" rel="start">Inizio</a>][<a href="index_toc.it.html#SEC_Contents" title="Indice" rel="contents">Contenuti</a>][<a href="lilypond-command-index.it.html" title="Indice" rel="index">Indice</a>][<a href="index_abt.it.html#SEC_About" title="Informazioni (aiuto)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="notation-manual-tables.it.html" title="Capitolo successivo">&nbsp;Notation manual tables &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="modifying-broken-spanners.it.html#using-alterbroken" title="Sezione precedente in ordine di lettura" accesskey="p" rel="previous"> &lt; Using alterBroken&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="advanced-tweaks.it.html" title="Sezione superiore" accesskey="u" rel="up">&nbsp; Su :&nbsp;Advanced tweaks&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="using-music-functions.it.html" title="Sezione successiva in ordine di lettura" accesskey="n" rel="next">&nbsp;Using music functions &gt; </a>]</td></tr></table>
<a name="unpure_002dpure-containers"></a>
<h3 class="subsection">5.5.6 Unpure-pure containers</h3>

<a name="index-Scheme_002c-pure-containers"></a>
<a name="index-Scheme_002c-unpure-containers"></a>
<a name="index-pure-containers_002c-Scheme"></a>
<a name="index-unpure-containers_002c-Scheme"></a>
<a name="index-horizontal-spacing_002c-overriding"></a>

<p>Unpure-pure containers are useful for overriding <em>Y-axis</em> spacing
calculations - specifically <code>Y-offset</code> and <code>Y-extent</code> - with a
Scheme function instead of a literal (i.e. a number or pair).
</p>
<p>For certain grobs, the <code>Y-extent</code> is based on the <code>stencil</code>
property, overriding the stencil property of one of these will
require an additional <code>Y-extent</code> override with an unpure-pure
container.  When a function overrides a <code>Y-offset</code> and/or
<code>Y-extent</code> it is assumed that this will trigger line breaking
calculations too early during compilation.  So the function is not
evaluated at all (usually returning a value of &lsquo;<samp>0</samp>&rsquo; or
&lsquo;<samp>'(0 . 0)</samp>&rsquo;) which can result in collisions.  A &lsquo;pure&rsquo; function
will not affect properties, objects or grob suicides and therefore will
always have its Y-axis-related evaluated correctly.
</p>
<p>Currently, there are about thirty functions that are already considered
&lsquo;pure&rsquo; and Unpure-pure containers are a way to set functions not on
this list as &lsquo;pure&rsquo;.  The &lsquo;pure&rsquo; function is evaluated <em>before</em>
any line-breaking and so the horizontal spacing can be adjusted
&lsquo;in time&rsquo;.  The &lsquo;unpure&rsquo; function is then evaluated <em>after</em>
line breaking.
</p>
<div class="warning"><p><strong>Nota:</strong> As it is difficult to always know which functions are on this
list we recommend that any &lsquo;pure&rsquo; functions you create do not use
<code>Beam</code> or <code>VerticalAlignment</code> grobs.
</p>
</div>
<p>An unpure-pure container is constructed as follows;
</p>
<p><code>(ly:make-unpure-pure-container f0 f1)</code>
</p>
<p>where <code>f0</code> is a function taking <var>n</var> arguments (<var>n &gt;= 1</var>)
and the first argument must always be the grob.  This is the function
that gives the actual result.  <var>f1</var> is the function being labeled
as &lsquo;pure&rsquo; that takes <var>n + 2</var> arguments.  Again, the first argument
must always still be the grob but the second and third are &lsquo;start&rsquo;
and &lsquo;end&rsquo; arguments.
</p>
<p><var>start</var> and <var>end</var> are, for all intents and purposes, dummy
values that only matter for <code>Spanners</code> (i.e <code>Hairpin</code> or
<code>Beam</code>), that can return different height estimations based on a
starting and ending column.
</p>
<p>The rest are the other arguments to the first function (which
may be none if <var>n = 1</var>).
</p>
<p>The results of the second function are used as an approximation of the
value needed which is then used by the first function to get the real
value which is then used for fine-tuning much later during the spacing
process.
</p>
<blockquote><pre class="verbatim">#(define (square-line-circle-space grob)
(let* ((pitch (ly:event-property (ly:grob-property grob 'cause) 'pitch))
      (notename (ly:pitch-notename pitch)))
 (if (= 0 (modulo notename 2))
     (make-circle-stencil 0.5 0.0 #t)
     (make-filled-box-stencil '(0 . 1.0)
                              '(-0.5 . 0.5)))))

squareLineCircleSpace = {
  \override NoteHead.stencil = #square-line-circle-space
}

smartSquareLineCircleSpace = {
  \squareLineCircleSpace
  \override NoteHead.Y-extent =
   #(ly:make-unpure-pure-container
      ly:grob::stencil-height
      (lambda (grob start end) (ly:grob::stencil-height grob)))
}

\new Voice \with { \remove &quot;Stem_engraver&quot; }
\relative c'' {
  \squareLineCircleSpace
  cis4 ces disis d
  \smartSquareLineCircleSpace
  cis4 ces disis d
}
</pre><p>
 <a href="../0d/lily-1d458801.ly">
  <img align="middle"
       border="0"
       src="../0d/lily-1d458801.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>In the first measure, without the unpure-pure container, the spacing
engine does not know the width of the note head and lets it collide with
the accidentals.  In the second measure, with unpure-pure containers,
the spacing engine knows the width of the note heads and avoids the
collision by lengthening the line accordingly.
</p>
<p>Usually for simple calculations nearly-identical functions for
both the &lsquo;unpure&rsquo; and &lsquo;pure&rsquo; parts can be used, by only
changing the number of arguments passed to, and the scope of, the
function.  This use case is frequent enough that
<code>ly:make-unpure-pure-container</code> constructs such a second
function by default when called with only one function argument.
</p>
<div class="warning"><p><strong>Nota:</strong> If a function is labeled as &lsquo;pure&rsquo; and it turns out not to
be, the results can be unexpected.
</p>
</div>

<hr size="6">
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="changing-defaults.it.html" title="Inizio di questo capitolo o capitolo precedente"> &lt;&lt; Changing defaults&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.it.html" title="Copertina (inizio) del documento" rel="start">Inizio</a>][<a href="index_toc.it.html#SEC_Contents" title="Indice" rel="contents">Contenuti</a>][<a href="lilypond-command-index.it.html" title="Indice" rel="index">Indice</a>][<a href="index_abt.it.html#SEC_About" title="Informazioni (aiuto)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="notation-manual-tables.it.html" title="Capitolo successivo">&nbsp;Notation manual tables &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="modifying-broken-spanners.it.html#using-alterbroken" title="Sezione precedente in ordine di lettura" accesskey="p" rel="previous"> &lt; Using alterBroken&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="advanced-tweaks.it.html" title="Sezione superiore" accesskey="u" rel="up">&nbsp; Su :&nbsp;Advanced tweaks&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="using-music-functions.it.html" title="Sezione successiva in ordine di lettura" accesskey="n" rel="next">&nbsp;Using music functions &gt; </a>]</td></tr></table>
<!-- footer_tag -->
<div class="footer">
<!-- This footer was autogenerated by /home/gub/NewGub/gub/target/linux-x86/build/lilypond-git.sv.gnu.org--lilypond.git-release-unstable/scripts/build/out/www_post -->
<p class="footer_version">
Questa pagina documenta LilyPond-2.19.32 (ramo di sviluppo).
</p>
<p class="footer_report">
We welcome your aid; please <a href="http://lilypond.org/help-us.html">help us</a> by reporting errors to our <a href="http://post.gmane.org/post.php?group=gmane.comp.gnu.lilypond.bugs">bug list</a>.
</p>
</div>


<p id="languages">
<!-- These links were autogenerated by /home/gub/NewGub/gub/target/linux-x86/build/lilypond-git.sv.gnu.org--lilypond.git-release-unstable/scripts/build/out/www_post -->
 Altre lingue: <a href="unpure_002dpure-containers.html">English</a>, <a href="unpure_002dpure-containers.de.html">deutsch</a>, <a href="unpure_002dpure-containers.es.html">español</a>, <a href="unpure_002dpure-containers.fr.html">français</a>, <a href="unpure_002dpure-containers.ja.html">日本語</a>.
 <br>
 About <a href="http://www.lilypond.org/website/misc/browser-language">automatic language selection</a>.
</p>

<!-- FOOTER -->

<!-- end div#main here -->
</div>



<div id="tocframe">
<p class="toc_uplink"><a href="../../Documentation/web/manuals.it.html"
         title="Documentation Index">&lt;&lt; Torna all'indice della documentazione</a></p>
<h4 class="toc_header"> <a href="index.it.html" title="Start of the manual">LilyPond &mdash; Guida alla Notazione  v2.19.32 (ramo di sviluppo). </a></h4>
<div class="contents">
<ul class="toc">
  <li class=""><a name="toc-Notazione-musicale-1" href="musical-notation.it.html">1. Notazione musicale</a>
  <ul class="toc">
    <li class=""><a name="toc-Altezze-1" href="pitches.it.html">1.1 Altezze</a>    </li>
    <li class=""><a name="toc-Ritmi-1" href="rhythms.it.html">1.2 Ritmi</a>    </li>
    <li class=""><a name="toc-Segni-di-espressione-1" href="expressive-marks.it.html">1.3 Segni di espressione</a>    </li>
    <li class=""><a name="toc-Ripetizioni-1" href="repeats.it.html">1.4 Ripetizioni</a>    </li>
    <li class=""><a name="toc-Note-simultanee-1" href="simultaneous-notes.it.html">1.5 Note simultanee</a>    </li>
    <li class=""><a name="toc-Notazione-del-rigo-1" href="staff-notation.it.html">1.6 Notazione del rigo</a>    </li>
    <li class=""><a name="toc-Note-editoriali-1" href="editorial-annotations.it.html">1.7 Note editoriali</a>    </li>
    <li class=""><a name="toc-Testo-1" href="text.it.html">1.8 Testo</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Notazione-specialistica-1" href="specialist-notation.it.html">2. Notazione specialistica</a>
  <ul class="toc">
    <li class=""><a name="toc-Musica-vocale-1" href="vocal-music.it.html">2.1 Musica vocale</a>    </li>
    <li class=""><a name="toc-Keyboard-and-other-multi_002dstaff-instruments-1" href="keyboard-and-other-multi_002dstaff-instruments.it.html">2.2 Keyboard and other multi-staff instruments</a>    </li>
    <li class=""><a name="toc-Unfretted-string-instruments-1" href="unfretted-string-instruments.it.html">2.3 Unfretted string instruments</a>    </li>
    <li class=""><a name="toc-Fretted-string-instruments-1" href="fretted-string-instruments.it.html">2.4 Fretted string instruments</a>    </li>
    <li class=""><a name="toc-Percussion-1" href="percussion.it.html">2.5 Percussion</a>    </li>
    <li class=""><a name="toc-Wind-instruments-1" href="wind-instruments.it.html">2.6 Wind instruments</a>    </li>
    <li class=""><a name="toc-Chord-notation-1" href="chord-notation.it.html">2.7 Chord notation</a>    </li>
    <li class=""><a name="toc-Contemporary-music-1" href="contemporary-music.it.html">2.8 Contemporary music</a>    </li>
    <li class=""><a name="toc-Ancient-notation-1" href="ancient-notation.it.html">2.9 Ancient notation</a>    </li>
    <li class=""><a name="toc-World-music-1" href="world-music.it.html">2.10 World music</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-General-input-and-output-1" href="general-input-and-output.it.html">3. General input and output</a>
  <ul class="toc">
    <li class=""><a name="toc-Input-structure-1" href="input-structure.it.html">3.1 Input structure</a>    </li>
    <li class=""><a name="toc-Titles-and-headers-1" href="titles-and-headers.it.html">3.2 Titles and headers</a>    </li>
    <li class=""><a name="toc-Working-with-input-files-1" href="working-with-input-files.it.html">3.3 Working with input files</a>    </li>
    <li class=""><a name="toc-Controlling-output-1" href="controlling-output.it.html">3.4 Controlling output</a>    </li>
    <li class=""><a name="toc-Creating-MIDI-output-1" href="creating-midi-output.it.html">3.5 Creating MIDI output</a>    </li>
    <li class=""><a name="toc-Extracting-musical-information-1" href="extracting-musical-information.it.html">3.6 Extracting musical information</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Spacing-issues-1" href="spacing-issues.it.html">4. Spacing issues</a>
  <ul class="toc">
    <li class=""><a name="toc-Page-layout-1" href="page-layout.it.html">4.1 Page layout</a>    </li>
    <li class=""><a name="toc-Score-layout-1" href="score-layout.it.html">4.2 Score layout</a>    </li>
    <li class=""><a name="toc-Breaks-1" href="breaks.it.html">4.3 Breaks</a>    </li>
    <li class=""><a name="toc-Vertical-spacing-1" href="vertical-spacing.it.html">4.4 Vertical spacing</a>    </li>
    <li class=""><a name="toc-Horizontal-spacing-1" href="horizontal-spacing.it.html">4.5 Horizontal spacing</a>    </li>
    <li class=""><a name="toc-Fitting-music-onto-fewer-pages-1" href="fitting-music-onto-fewer-pages.it.html">4.6 Fitting music onto fewer pages</a>    </li>
  </ul>
  </li>
  <li class=" toc_current"><a name="toc-Changing-defaults-1" href="changing-defaults.it.html">5. Changing defaults</a>
  <ul class="toc">
    <li class=""><a name="toc-Interpretation-contexts-1" href="interpretation-contexts.it.html">5.1 Interpretation contexts</a>    </li>
    <li class=""><a name="toc-Explaining-the-Internals-Reference-1" href="explaining-the-internals-reference.it.html">5.2 Explaining the Internals Reference</a>    </li>
    <li class=""><a name="toc-Modifying-properties-1" href="modifying-properties.it.html">5.3 Modifying properties</a>    </li>
    <li class=""><a name="toc-Useful-concepts-and-properties-1" href="useful-concepts-and-properties.it.html">5.4 Useful concepts and properties</a>    </li>
    <li class=" toc_current"><a name="toc-Advanced-tweaks-1" href="advanced-tweaks.it.html">5.5 Advanced tweaks</a>
    <ul class="toc">
      <li class=""><a name="toc-Aligning-objects-1" href="aligning-objects.it.html">5.5.1 Aligning objects</a>      </li>
      <li class=""><a name="toc-Vertical-grouping-of-grobs-1" href="vertical-grouping-of-grobs.it.html">5.5.2 Vertical grouping of grobs</a>      </li>
      <li class=""><a name="toc-Modifying-stencils-1" href="modifying-stencils.it.html">5.5.3 Modifying stencils</a>      </li>
      <li class=""><a name="toc-Modifying-shapes-1" href="modifying-shapes.it.html">5.5.4 Modifying shapes</a>      </li>
      <li class=""><a name="toc-Modifying-broken-spanners-1" href="modifying-broken-spanners.it.html">5.5.5 Modifying broken spanners</a>      </li>
      <li class=" toc_current"><a name="toc-Unpure_002dpure-containers-1" href="unpure_002dpure-containers.it.html">5.5.6 Unpure-pure containers</a>      </li>
    </ul>
    </li>
    <li class=""><a name="toc-Using-music-functions-1" href="using-music-functions.it.html">5.6 Using music functions</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Notation-manual-tables-1" href="notation-manual-tables.it.html">A. Notation manual tables</a>
  <ul class="toc">
    <li class=""><a name="toc-Chord-name-chart-1" href="chord-name-chart.it.html">A.1 Chord name chart</a>    </li>
    <li class=""><a name="toc-Common-chord-modifiers-1" href="common-chord-modifiers.it.html">A.2 Common chord modifiers</a>    </li>
    <li class=""><a name="toc-Predefined-string-tunings-1" href="predefined-string-tunings.it.html">A.3 Predefined string tunings</a>    </li>
    <li class=""><a name="toc-Predefined-fretboard-diagrams-1" href="predefined-fretboard-diagrams.it.html">A.4 Predefined fretboard diagrams</a>    </li>
    <li class=""><a name="toc-Predefined-paper-sizes-1" href="predefined-paper-sizes.it.html">A.5 Predefined paper sizes</a>    </li>
    <li class=""><a name="toc-MIDI-instruments-1" href="midi-instruments.it.html">A.6 MIDI instruments</a>    </li>
    <li class=""><a name="toc-List-of-colors-1" href="list-of-colors.it.html">A.7 List of colors</a>    </li>
    <li class=""><a name="toc-The-Feta-font-1" href="the-feta-font.it.html">A.8 The Feta font</a>    </li>
    <li class=""><a name="toc-Note-head-styles-1" href="note-head-styles.it.html">A.9 Note head styles</a>    </li>
    <li class=""><a name="toc-Clef-styles-1" href="clef-styles.it.html">A.10 Clef styles</a>    </li>
    <li class=""><a name="toc-Text-markup-commands-1" href="text-markup-commands.it.html">A.11 Text markup commands</a>    </li>
    <li class=""><a name="toc-Text-markup-list-commands-1" href="text-markup-list-commands.it.html">A.12 Text markup list commands</a>    </li>
    <li class=""><a name="toc-List-of-special-characters-1" href="list-of-special-characters.it.html">A.13 List of special characters</a>    </li>
    <li class=""><a name="toc-List-of-articulations-1" href="list-of-articulations.it.html">A.14 List of articulations</a>    </li>
    <li class=""><a name="toc-Percussion-notes-1" href="percussion-notes.it.html">A.15 Percussion notes</a>    </li>
    <li class=""><a name="toc-Technical-glossary-1" href="technical-glossary.it.html">A.16 Technical glossary</a>    </li>
    <li class=""><a name="toc-All-context-properties-1" href="all-context-properties.it.html">A.17 All context properties</a>    </li>
    <li class=""><a name="toc-Layout-properties-1" href="layout-properties.it.html">A.18 Layout properties</a>    </li>
    <li class=""><a name="toc-Available-music-functions-1" href="available-music-functions.it.html">A.19 Available music functions</a>    </li>
    <li class=""><a name="toc-Context-modification-identifiers-1" href="context-modification-identifiers.it.html">A.20 Context modification identifiers</a>    </li>
    <li class=""><a name="toc-Predefined-type-predicates-1" href="predefined-type-predicates.it.html">A.21 Predefined type predicates</a>    </li>
    <li class=""><a name="toc-Scheme-functions-1" href="scheme-functions.it.html">A.22 Scheme functions</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Cheat-sheet-1" href="cheat-sheet.it.html">B. Cheat sheet</a>  </li>
  <li class=""><a name="toc-GNU-Free-Documentation-License-1" href="gnu-free-documentation-license.it.html">C. GNU Free Documentation License</a>  </li>
  <li class=""><a name="toc-Indice-dei-comandi-di-LilyPond-1" href="lilypond-command-index.it.html">D. Indice dei comandi di LilyPond</a>  </li>
  <li class=""><a name="toc-Indice-di-LilyPond-1" href="lilypond-index.it.html">E. Indice di LilyPond</a>  </li>
<li>
<!--
    Translation of GIT committish: 1df9fc42197a6b2931f448cfba717527aead5e5a

    When revising a translation, copy the HEAD committish of the
    version that you are working on.  See TRANSLATION for details.
-->

<form action="http://google.com/search"
      method="get"
      name="search"
      onSubmit="search.q.value='site:lilypond.org/doc/v2.19 '
		+ search.brute_query.value"
      onMouseMove="search.q.value='site:lilypond.org/doc/v2.19 '
		   + search.brute_query.value"
      onKeyUp="search.q.value='site:lilypond.org/doc/v2.19 '
	       + search.brute_query.value">
  <input type="hidden" name="btnG" value="Cerca con Google">
  <input type="text" name="brute_query" onfocus="this.value=''" value="Cerca">
  <input type="hidden" name="q" value="">
</form>
</li>
</ul>
</div>
</div>

</body>
</html>
